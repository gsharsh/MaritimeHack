---
phase: 10-final-validation-submission
type: execute
---

<objective>
Run the full production pipeline with 108-vessel dataset, fill all placeholder values in deliverables, validate constraints independently, and package the final submission.

Purpose: This is the last phase — produce the actual hackathon submission with real numbers.
Output: Production submission CSV, charts from real data, case paper & presentation with real numbers, clean git commit.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@run.py
@src/optimization.py
@src/sensitivity.py
@src/constants.py
@outputs/deliverables/case_paper.md
@outputs/deliverables/presentation_outline.md
@outputs/submission/submission_template.csv

**Tech stack available:** PuLP, pandas, matplotlib, numpy
**Established patterns:** run.py --all runs full pipeline; submission CSV is 4-column format
**Constraining decisions:**
- Phase 6: Submission CSV preserves 4-column template format (Header Name, Data Type, Units, Submission)
- Phase 9: All deliverable numbers use {placeholder} syntax for production-run fill
- per_vessel.csv with 108 vessels is now present at data/processed/per_vessel.csv
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full production pipeline and capture output</name>
  <files>outputs/submission/submission_template.csv, outputs/charts/*.png</files>
  <action>
Run the full production pipeline with real data:

```
python run.py --all --team-name "REPmonkeys" --category "A" --report-file "case_paper.pdf"
```

Capture the ENTIRE stdout to a temporary file (e.g. `temp_production_output.txt`) so we can parse numbers for placeholder filling. This single command runs:
- Base case MILP optimization (108 vessels, 4,576,667 demand)
- Submission CSV generation with team metadata
- Safety threshold sweep (3.0/3.5/4.0/4.5)
- Pareto frontier (15-point epsilon-constraint)
- Carbon price sweep ($80/$120/$160/$200)
- Shadow prices, diversity what-if, fleet efficiency
- All 5 charts regenerated from production data

Verify the run completes without errors (exit code 0). If INFEASIBLE, stop and diagnose — the 108-vessel pool should easily cover 4.58M demand.

After successful run, read the captured output to extract all numbers needed for placeholder filling in Task 2.
  </action>
  <verify>
- Exit code 0
- outputs/submission/submission_template.csv has non-empty Submission values for all rows
- All 5 chart PNGs exist and are non-zero size in outputs/charts/
- Stdout shows "Fleet validation: PASS"
  </verify>
  <done>Production pipeline completes successfully with all outputs generated from 108-vessel dataset</done>
</task>

<task type="auto">
  <name>Task 2: Fill all placeholder values in case paper and presentation</name>
  <files>outputs/deliverables/case_paper.md, outputs/deliverables/presentation_outline.md</files>
  <action>
Parse the production output from Task 1 to extract real numbers. Then search-and-replace every {placeholder} in both deliverable files.

**Placeholders to fill (extract from production output):**

Base case metrics (from "Fleet Selection Results" section):
- {fleet_size} — size_of_fleet_count
- {total_cost} — total_cost_of_fleet (format as comma-separated with 2 decimals)
- {total_dwt} — sum_of_fleet_deadweight (format as comma-separated integer)
- {avg_safety} — average_fleet_safety_score (2 decimals)
- {fuel_types} — no_of_unique_main_engine_fuel_types_in_fleet
- {total_co2eq} — total_emission_CO2_eq (2 decimals)
- {total_fuel} — total_fuel_consumption (2 decimals)

Pareto frontier (from "Cost-Emissions Pareto Frontier" section):
- {base_co2eq} — CO2eq at first Pareto point (base case, no cap)
- {min_co2eq} — CO2eq at last feasible Pareto point (tightest cap)
- {min_shadow_price} — lowest shadow_carbon_price from Pareto table
- {max_shadow_price} — highest shadow_carbon_price from Pareto table
- {cost_min_emissions_pareto} — cost at the minimum-emissions Pareto point
- {cost_max_emissions_pareto} — cost at the base (max-emissions) Pareto point

Safety sweep (from "Safety Threshold Sweep" section):
- {cost_s30} — total cost at threshold 3.0
- {cost_s40} — total cost at threshold 4.0
- {pct_increase_s40} — percentage increase from 3.0 to 4.0 (calculate: (cost_s40 - cost_s30) / cost_s30 * 100, round to 1 decimal)
- {status_s45} — "is feasible at cost $X" or "becomes infeasible" depending on result

Shadow prices (from "Shadow Prices" section):
- {dwt_shadow_price} — DWT shadow price per tonne
- {safety_shadow_price} — safety shadow price per 0.1-point increase

Diversity what-if (from "Fuel Diversity What-If" section):
- {diversity_savings} — cost of diversity constraint (absolute dollar amount)
- {pct_diversity} — percentage cost impact of diversity
- {fuel_types_lost} — count or list of fuel types lost without diversity

Carbon sweep (from "Carbon Price Sweep" section):
- {cost_cp80} — total cost at $80/tCO2eq
- {cost_cp200} — total cost at $200/tCO2eq

MACC (from Pareto data — count shadow prices below/above $80):
- {macc_below_ref} — count of Pareto steps with shadow_carbon_price < $80
- {macc_above_ref} — count of Pareto steps with shadow_carbon_price >= $80

Fleet efficiency (from "Fleet Efficiency Metrics" section):
- {cost_per_dwt} — cost per DWT
- {co2_per_dwt} — CO2eq per DWT
- {dwt_per_vessel} — DWT per vessel
- {utilization} — capacity utilization ratio

**Format guidelines:**
- Dollar amounts: use comma-separated with appropriate precision (e.g., "$12,345,678.90" for total cost, "$45.23" for per-unit)
- Percentages: 1 decimal place (e.g., "12.3%")
- Large integers: comma-separated (e.g., "4,576,667")
- Small decimals: 2-4 significant figures as appropriate

After replacing, verify ZERO {placeholder} patterns remain in either file. Use grep to confirm.
  </action>
  <verify>
- `grep -c '{[a-z_]*}' outputs/deliverables/case_paper.md` returns 0
- `grep -c '{[a-z_]*}' outputs/deliverables/presentation_outline.md` returns 0
- Spot-check: fleet_size, total_cost, avg_safety match submission CSV values
  </verify>
  <done>Both deliverable files have all placeholders replaced with production numbers; zero {placeholder} patterns remain</done>
</task>

<task type="auto">
  <name>Task 3: Independent constraint validation and submission sanity check</name>
  <files>outputs/submission/submission_template.csv</files>
  <action>
Write a short Python validation script (inline or temporary) that independently verifies the submission is correct:

1. **Load per_vessel.csv** and the submission CSV
2. **Re-check all 4 constraints** against the MILP-selected fleet:
   - DWT >= 4,576,667
   - Average safety >= 3.0
   - All 8 fuel types present
   - Each vessel selected at most once (no duplicates in selected set)
3. **Cross-check submission values** match what the MILP actually produced:
   - sum_of_fleet_deadweight matches sum of selected vessels' DWT
   - total_cost_of_fleet matches sum of selected vessels' final_cost
   - average_fleet_safety_score matches weighted average
   - size_of_fleet_count matches count of selected vessels
4. **Verify submission format**: 4 columns (Header Name, Data Type, Units, Submission), all rows have Submission values, team_name/category/report_file_name are filled
5. **Print a clear PASS/FAIL for each check**

If any check fails, diagnose and fix before proceeding.

Also verify the 5 chart files are non-trivially sized (> 10KB each), confirming they rendered from production data and not just test fixtures.

Clean up temp_production_output.txt after validation.
  </action>
  <verify>
- All 4 constraint checks PASS
- All cross-checks PASS
- Submission CSV has all fields filled including team metadata
- All 5 charts > 10KB
  </verify>
  <done>Independent validation confirms submission is correct, all constraints satisfied, all deliverables ready</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python run.py --all` completes with exit code 0
- [ ] Submission CSV has correct production values (not test fixture values)
- [ ] sum_of_fleet_deadweight >= 4,576,667
- [ ] average_fleet_safety_score >= 3.0
- [ ] no_of_unique_main_engine_fuel_types_in_fleet >= 8
- [ ] Case paper has zero remaining {placeholder} values
- [ ] Presentation outline has zero remaining {placeholder} values
- [ ] All 5 charts regenerated from production data (> 10KB each)
- [ ] team_name, category, report_file_name filled in submission CSV
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Production data used (108 vessels, not 5 test fixtures)
- Submission CSV ready for upload
- Deliverable documents have real numbers throughout
- Phase 10 complete — project ready for submission
</success_criteria>

<output>
After completion, create `.planning/phases/10-final-validation-submission/10-01-SUMMARY.md`
</output>
