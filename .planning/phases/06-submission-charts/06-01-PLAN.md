---
phase: 06-submission-charts
plan: 01
type: execute
---

<objective>
Fill submission CSV with base case MILP results and generate Pareto frontier chart.

Purpose: Produce the required submission file and the primary analysis chart for the case paper.
Output: outputs/submission/submission_template.csv (filled), outputs/charts/pareto_frontier.png
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key source files:
@src/optimization.py
@src/sensitivity.py
@src/data_adapter.py
@src/constants.py
@run.py
@given_data/submission_template.csv
@given_data/submission_template - SAMPLE SUBMISSION.csv

# Prior phase summaries (dependency graph):
@.planning/phases/04-safety-threshold-sweep/04-01-SUMMARY.md
@.planning/phases/05-pareto-frontier/05-01-SUMMARY.md
@.planning/phases/05-pareto-frontier/05-02-SUMMARY.md

**Tech stack available:** PuLP, pandas, matplotlib, numpy
**Established patterns:** sweep-loop-over-milp, format_*_table() returning DataFrames, submission_outputs() already in optimization.py
**Constraining decisions:**
- submission_outputs() in optimization.py already maps metrics dict to submission column names
- Submission CSV format: 4-column layout (Header Name, Data Type, Units, Submission) — fill the Submission column
- Team name, category, report_file_name are string fields to be filled at submission time
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate submission CSV from MILP base case</name>
  <files>run.py, outputs/submission/submission_template.csv</files>
  <action>
Add a `--submit` CLI flag to run.py. When passed, after running the base-case MILP:

1. Call `submission_outputs(metrics, sensitivity_done=True)` (sensitivity IS done — we have safety sweep, Pareto, and carbon sweep)
2. Read `given_data/submission_template.csv` into a DataFrame (it has columns: Header Name, Data Type, Units, Submission)
3. Map each row's "Header Name" value to the corresponding value from submission_outputs() dict
4. Write the filled DataFrame to `outputs/submission/submission_template.csv` (overwrite the placeholder)
5. Print the submission values to console for verification

Import `submission_outputs` from `src.optimization` (already exists with correct column mapping).

Do NOT hardcode team_name/category/report_file_name — accept them via CLI args `--team-name`, `--category`, `--report-file` with empty string defaults so the team can fill them at submission time.

Ensure the output CSV preserves the exact 4-column structure of the template (Header Name, Data Type, Units, Submission).
  </action>
  <verify>python run.py --submit prints submission values and outputs/submission/submission_template.csv has non-empty Submission column for numeric fields</verify>
  <done>outputs/submission/submission_template.csv has all 11 rows filled (strings may be empty defaults, numeric fields populated from MILP), --submit flag works end-to-end</done>
</task>

<task type="auto">
  <name>Task 2: Generate Pareto frontier chart</name>
  <files>src/charts.py, run.py</files>
  <action>
Create `src/charts.py` with a `plot_pareto_frontier()` function:

1. Accept the Pareto sweep results list (from run_pareto_sweep()) as input
2. Filter to feasible points only
3. Plot Total Cost (USD, y-axis) vs Total CO2eq (tonnes, x-axis) as a line+scatter plot
4. Label axes clearly: "Total CO2eq (tonnes)" and "Total Fleet Cost (USD)"
5. Title: "Cost-Emissions Pareto Frontier"
6. Add grid lines for readability
7. Annotate the base case point (first point = min cost) and the min-emissions point (last point) with text labels
8. Use matplotlib.pyplot, save to `outputs/charts/pareto_frontier.png` at 150 DPI
9. Use `plt.tight_layout()` before saving to avoid clipped labels
10. Call `plt.close()` after saving to free memory (avoid display in non-interactive mode)

Wire into run.py: when `--pareto` is passed, after printing the Pareto table, also call `plot_pareto_frontier()` and print the saved file path. Create `outputs/charts/` directory if it doesn't exist (use `os.makedirs(exist_ok=True)`).

Use `matplotlib.use('Agg')` at the top of charts.py to avoid Tkinter issues in headless/CLI mode. This MUST be set before importing pyplot.
  </action>
  <verify>python run.py --pareto produces outputs/charts/pareto_frontier.png and the file is a valid PNG (non-zero size)</verify>
  <done>Pareto chart saved to outputs/charts/pareto_frontier.png showing cost vs emissions tradeoff curve with labeled axes, title, and annotated endpoints</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python run.py --submit` fills submission CSV correctly
- [ ] `python run.py --pareto` generates Pareto chart PNG
- [ ] outputs/submission/submission_template.csv has correct structure and populated values
- [ ] outputs/charts/pareto_frontier.png exists and is non-zero size
- [ ] No import errors or runtime exceptions
</verification>

<success_criteria>

- Submission CSV filled with base case MILP results
- Pareto frontier chart generated as PNG
- Both wired into run.py CLI
- All verification checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-submission-charts/06-01-SUMMARY.md`
</output>
