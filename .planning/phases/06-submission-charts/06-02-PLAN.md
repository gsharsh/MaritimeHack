---
phase: 06-submission-charts
plan: 02
type: execute
---

<objective>
Generate fleet composition stacked bar chart and safety threshold comparison table chart.

Purpose: Produce remaining analysis charts for the case paper — fleet composition by fuel type and safety threshold comparison.
Output: outputs/charts/fleet_composition.png, outputs/charts/safety_comparison.png
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key source files:
@src/charts.py
@src/sensitivity.py
@src/constants.py
@run.py

# Prior plan in this phase:
@.planning/phases/06-submission-charts/06-01-SUMMARY.md

**Tech stack available:** matplotlib, pandas, numpy
**Established patterns:** plot_pareto_frontier() pattern in charts.py, sweep results as list of dicts
**Constraining decisions:**
- Charts use matplotlib with Agg backend (set in charts.py)
- All charts save to outputs/charts/ at 150 DPI
- Safety sweep results from run_safety_sweep() contain fuel_type_counts dict per threshold
- Carbon sweep results from run_carbon_price_sweep() contain fuel_type_counts dict per price
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate fleet composition stacked bar chart</name>
  <files>src/charts.py, run.py</files>
  <action>
Add `plot_fleet_composition()` to `src/charts.py`:

1. Accept safety sweep results list (from run_safety_sweep()) as input
2. For each feasible threshold, build a stacked bar showing vessel count by fuel type
3. X-axis: safety thresholds (3.0, 3.5, 4.0, 4.5)
4. Y-axis: number of vessels
5. Each fuel type is a different color segment in the stack (use a colormap with 8 distinct colors, e.g. tab10)
6. Legend showing fuel type names, placed outside the plot area (bbox_to_anchor) or below to avoid overlap
7. Title: "Fleet Composition by Safety Threshold"
8. Skip infeasible thresholds (don't show a bar for them, or show an empty bar with "INFEASIBLE" label)
9. Save to `outputs/charts/fleet_composition.png` at 150 DPI
10. Use tight_layout() and close() as in Pareto chart

Wire into run.py: when `--sweep` is passed, after printing the sweep table, also call `plot_fleet_composition()` and print the saved file path.
  </action>
  <verify>python run.py --sweep produces outputs/charts/fleet_composition.png and file is valid PNG</verify>
  <done>Fleet composition stacked bar chart saved showing vessel counts by fuel type across safety thresholds</done>
</task>

<task type="auto">
  <name>Task 2: Generate safety threshold comparison table chart</name>
  <files>src/charts.py, run.py</files>
  <action>
Add `plot_safety_comparison()` to `src/charts.py`:

1. Accept safety sweep results list (from run_safety_sweep()) as input
2. Create a matplotlib table visualization (use plt.table() or ax.table()) showing key metrics across thresholds
3. Columns: Threshold, Fleet Size, Total Cost ($M), Avg Safety, Total CO2eq (kt), Total DWT (kt)
4. Format numbers readably: costs in millions ($XM), CO2eq in kilotonne, DWT in kilotonne
5. Color-code rows: green for base case (3.0), yellow/orange for higher thresholds, red for infeasible
6. Title: "Safety Threshold Comparison"
7. Remove axes (it's a table, not a plot)
8. Save to `outputs/charts/safety_comparison.png` at 150 DPI, use tight_layout() and close()

Wire into run.py: when `--sweep` is passed, also call `plot_safety_comparison()` after the composition chart. Print saved file path.

Add a convenience `--all` flag to run.py that sets sweep=True, pareto=True, carbon_sweep=True, submit=True — runs everything in one go for final submission preparation.
  </action>
  <verify>python run.py --sweep produces outputs/charts/safety_comparison.png; python run.py --all runs all analyses and generates all outputs</verify>
  <done>Safety comparison table chart saved, --all flag works end-to-end producing all outputs (submission CSV + 3 charts). Phase 6 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python run.py --sweep` generates both fleet_composition.png and safety_comparison.png
- [ ] `python run.py --all` runs everything and produces all 4 outputs (submission CSV + 3 charts)
- [ ] All chart PNGs are non-zero size
- [ ] No import errors or runtime exceptions
- [ ] All prior functionality still works (base MILP, --pareto, --carbon-sweep, --submit)
</verification>

<success_criteria>

- All 3 charts generated (Pareto frontier, fleet composition, safety comparison)
- Submission CSV filled
- --all convenience flag works
- Phase 6 complete — all deliverables ready
</success_criteria>

<output>
After completion, create `.planning/phases/06-submission-charts/06-02-SUMMARY.md`

This is the LAST plan. Success criteria includes: "Phase 6 complete — all submission deliverables ready for Maritime Hackathon 2026."
</output>
